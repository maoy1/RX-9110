# RX-9110 & CICD pipeline to Deploy a Web App to Amazon EC2
The ticket itself is about analyze xfire fabrication log to check the bottleneck of sub steps. The solution is in dash_app.
Beside this app, there's CICD implemented, with the smallest setup I can find to serve especially Continues Deployment with AWS CodeDeploy

## RX-9110 Solution Overview
### Key Files in dash_app
- `app.py`: The dashboard web application
- `extract_start_db_jenkins_build_xml.py`: extract data from "start db fabrication" build job log
- `extract_xfrun_log.py`: extract data from xfrun log for job details
### Other important facts
- logs are located in s3://xfirefabanalyzerstack-webappdeploymentbucket-gguw7zonzjwy/data/ (generated by cloudfromation, could be change)
- New jenkins job logs are to be added in builds sub folder, they should be the content from "start db fabrication", under "/var/lib/jenkins/jobs/start db fabrication/builds/"
- New xfrun job logs are to be added in xfrun sub folder, xfrun logs are in xfire2fab instance. use `egrep -Hwi "BEGIN|ENDED"` to extract the data, please give a file name which can be sorted correctly.
- App can be accessed from http://xfiref-appli-otxohgjykxle-557464543.us-east-1.elb.amazonaws.com:8080/ (generated by cloudfromation, could be change)
- please click "Update Data Files" by start the app or data updated on s3

## CICD pipeline Solution Overview
This solution are mainly inspired from two tutorials:
- https://aws.amazon.com/blogs/devops/integrating-with-github-actions-ci-cd-pipeline-to-deploy-a-web-app-to-amazon-ec2/
- https://medium.com/@andrewlui_60044/deploy-a-python-application-on-a-aws-ci-cd-pipeline-part-1-code-repository-1090ff888eaa (Part 1/2/3)

### Key Files
- `dash_app`: The dash app implemented for RX-9110
- `cloudformation/template.yaml`: The cloudformation template to create whole stack
- `.github/workflows/deploy.yml`: Github Action to initiate the deployment
- `appspec.yml`: The application specification file for the deployment using AWS CodeDeploy
- `scripts/requirements.txt`: The list of Python modules to be installed during the deployment
- `scripts/dash.service`: The service specification file to be added as a Linux service.
- `scripts/after_install.sh`: The script file to execute during the AfterInstall phase of CodeDeploy.
- `scripts/start_dash.sh`: The script file to execute during the ApplicationStart phase of CodeDeploy.
- `scripts/stop_dash.sh`: The script file to execute during the ApplicationStop phase of CodeDeploy.


### Solution Overview

The solution utilizes following services:

1.	[GitHub Actions](https://docs.github.com/en/actions) : Workflow Orchestration tool that will host the Pipeline. 
2.	[AWS CodeDeploy](https://aws.amazon.com/codedeploy/) : AWS service to manage deployment on Amazon EC2 Autoscaling Group.
3.	[AWS Auto Scaling](https://aws.amazon.com/ec2/autoscaling/) : AWS Service to help maintain application availability and elasticity by automatically adding or removing EC2 instances. 
4.	[Amazon EC2](https://docs.aws.amazon.com/ec2/index.html?nc2=h_ql_doc_ec2#amazon-ec2) : Destination Compute server for the application deployment.
5.	[AWS CloudFormation](https://aws.amazon.com/cloudformation/) : AWS infrastructure as code (IaC) service used to spin up the initial infrastructure on AWS side.
6.	[IAM OIDC identity provider](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html) : Federated authentication service to establish trust between GitHub and AWS to allow GitHub Actions to deploy on AWS without maintaining AWS Secrets and credentials. 
7.	[Amazon S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html) : Amazon S3 to store the deployment artifacts.

The following diagram illustrates the architecture for the solution:
![Alt Text](aws-coodedeplooy-github-action-deploymentV3.png?raw=true  "Title")

## Walkthrough
The following steps provide a high-level overview of the walkthrough:

  1.	Clone the project from the [github](https://github.com/maoy1/RX-9110).
  2.	Deploy the AWS CloudFormation template to create the required services.
  3.	Update the source code.
  4.	Setup GitHub secrets.
  5.	Integrate CodeDeploy with GitHub
  6.	Trigger the GitHub Action to deploy the code.
  7.	Verify the deployment.

Details from step 2 to step 6 can be found in tutorial https://aws.amazon.com/blogs/devops/integrating-with-github-actions-ci-cd-pipeline-to-deploy-a-web-app-to-amazon-ec2/

